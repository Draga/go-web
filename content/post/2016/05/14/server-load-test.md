+++
author = ""
comments = true
date = "2016-05-14T14:50:14+01:00"
draft = false
featured = true
image = "/images/loadTest.png"
menu = ""
share = true
slug = "server-load-test"
tags = ["server", "nginx", "digitalocean", "https", "brotli", "load test"]
title = "Server load test"
description = "Load testing a $5 Digitalocean server"
+++

I've recently tried <a href="https://m.do.co/c/875cd23a5c97" target="_blank">Digitalocean</a> hosting and decided to host this blog on it. I'm running a $5 / month server, or droplet as they call it, with 1 CPU, 512 MB of ram, 20 GB SSD and 1 TB of bandwidth. You even get $10 credit when you sign up, sweet!

You may look down on a $5 machine but I've found it to be more than enough for my need.

I'm serving "static" content that has been generated by <a href="https://gohugo.io" target="_blank">Hugo</a>

I recently ran some load testing at work for a newly launched website so I decided to test this $5 server. I've been using <a href="https://loader.io" target="_blank">loader.io</a> since its basic usage is free.

## The test
The server responds to a certain number of clients every second for a full minute.

The majority of the users must receive the page in < 5 secs. Only the html is loaded.

## Plain HTML
10.000 requests a second! (that is the maximum that loaded.io goes on a free plan)

Don't let the number in the graph fools you, clients can be connected for more than 1 second and therefore count in the next frame.
<div style="width: 600px;">
<iframe width='600' height='300' frameborder='0' src='//share.loader.io/reports/d7bd6935223fa63bf482b2601c07b593/widget/results/1633f8b52732dee9fcfed8836753c9a1'></iframe>
<div style="width: 100%; text-align: right;">
<a href="https://loader.io/reports/d7bd6935223fa63bf482b2601c07b593/results/1633f8b52732dee9fcfed8836753c9a1" target="_blank" style="padding: 0 10px 10px 0; font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; font-size: 14px;">View on loader.io</a>
</div></div>

## Enable strong HTTPS
<a href="https://www.ssllabs.com/ssltest/analyze.html?d=https%3A%2F%2Fstefano.chiodino.uk" target="_blank">How strong you say?</a>

As expected enabling https is taking its toll. The server can't accommodate less than half of the requests, "just" 4.000.
<div style="width: 600px;">
<iframe width='600' height='300' frameborder='0' src='//share.loader.io/reports/b1133ec4e734ae2b5ee1bdafeb8c3357/widget/results/5a2e305c2a3a89359944d97bfb714fc3'></iframe>
<div style="width: 100%; text-align: right;">
<a href="https://loader.io/reports/b1133ec4e734ae2b5ee1bdafeb8c3357/results/5a2e305c2a3a89359944d97bfb714fc3" target="_blank" style="padding: 0 10px 10px 0; font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; font-size: 14px;">View on loader.io</a>
</div></div>

## Full on PageSpeed on strong HTTPS
I've then enabled Google's PageSpeed module for nginx and enabled every performance related filter!

I've enabled 27 extra filters on top of the 34 enabled by default, leaving just 7 out that were just for compatibility or counterproductive, hell I've even enabled the filter to make the G analytics script async when it's already implemented that way.

Result: a quite dramatic 150 clients/sec :D
<div style="width: 600px;">
<iframe width='600' height='300' frameborder='0' src='//share.loader.io/reports/9c07ef57ce5b1066d9637f88f0df6869/widget/results/ee611dc52b983f1aa077d97222ea4034'></iframe>
<div style="width: 100%; text-align: right;">
<a href="https://loader.io/reports/9c07ef57ce5b1066d9637f88f0df6869/results/ee611dc52b983f1aa077d97222ea4034" target="_blank" style="padding: 0 10px 10px 0; font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; font-size: 14px;">View on loader.io</a>
</div></div>

Here is the list of filters that I've enabled:

{{< gist draga 00114415fcd0971cc132c679dfdfc83a >}}

## Brotli (max compression)
Just add Accept-Encoding: br to loader.io request headers and... 75 clients / sec. Not bad considering that I've enabled the maximum (11) level of compression!
<div style="width: 600px;">
<iframe width='600' height='300' frameborder='0' src='//share.loader.io/reports/eba586377e1cd2192698b5d5c16fbb90/widget/results/073bfe136242a8a7479c78c713c92c53'></iframe>
<div style="width: 100%; text-align: right;">
<a href="http://loader.io/reports/eba586377e1cd2192698b5d5c16fbb90/results/073bfe136242a8a7479c78c713c92c53" target="_blank" style="padding: 0 10px 10px 0; font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; font-size: 14px;">View on loader.io</a>
</div></div>

..and, if you are curious about the compression, my homepage file sizes are (method from <a href="https://hacks.mozilla.org/2015/11/better-than-gzip-compression-with-brotli" target="_blank">Mozilla's brotli post </a>):

| Algorithm | Size |
|-----------|------|
| none      | 9508 |
| gzip      | 3344 |
| brotli    | 2732 |